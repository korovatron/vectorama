<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="theme-color" content="#16213e">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="description" content="Interactive vector mathematics and matrix transformation visualizer in 2D and 3D">
    <title>Vectorama - Matrix & Vector Visualizer</title>
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="images/icon-192.svg">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- Title Screen -->
    <div id="title-screen" class="title-screen">
        <div class="title-content">
            <img src="images/vectoramaLogo.png" alt="Vectorama Logo" class="title-logo">
            <p class="title-tagline">Good news, everyone! Vectors!</p>
            <button id="start-btn" class="start-btn">Start</button>
        </div>
    </div>
    
    <!-- Main App Container (hidden until Start is clicked) -->
    <div id="main-app" class="main-app" style="display: none;">
    <!-- Hamburger Menu Button -->
    <button id="panel-toggle-btn" class="panel-toggle-btn active">
        <span></span>
        <span></span>
        <span></span>
    </button>
    
    <div class="container">
        <!-- Control Panel -->
        <div class="control-panel">
            <h1>Vectorama</h1>
            <p class="subtitle" id="app-subtitle">Interactive Vector Mathematics</p>
            
            <!-- Top Button Row -->
            <div class="top-button-row">
                <!-- Split Button: Add with Dropdown -->
                <div class="split-button-container">
                    <button id="add-main-btn" class="split-button-main">
                        <span style="font-size: 16px;">+</span>&nbsp;Add
                    </button>
                    <button id="add-dropdown-toggle" class="split-button-dropdown" title="Show examples">
                        <svg width="12" height="12" viewBox="0 0 12 12" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="2,4 6,8 10,4"></polyline>
                        </svg>
                    </button>
                </div>
                
                <!-- Add Dropdown Menu (hidden by default) -->
                <div id="add-dropdown" class="add-dropdown" style="display: none;">
                    <div class="dropdown-item" data-action="add-vector">
                        <strong>+</strong> Add Vector
                    </div>
                    <div class="dropdown-item" data-action="add-matrix">
                        <strong>+</strong> Add Matrix
                    </div>
                    <div class="dropdown-separator"></div>
                    <div class="dropdown-header">Transformations</div>
                    <div class="dropdown-item" data-action="rotation-45">
                        Rotation 45¬∞
                    </div>
                    <div class="dropdown-item" data-action="rotation-90">
                        Rotation 90¬∞
                    </div>
                    <div class="dropdown-item" data-action="scale-2x">
                        Scale 2√ó
                    </div>
                    <div class="dropdown-item" data-action="shear-x">
                        Shear X
                    </div>
                    <div class="dropdown-item" data-action="reflection-x">
                        Reflection X
                    </div>
                    <div class="dropdown-item" data-action="reflection-y">
                        Reflection Y
                    </div>
                </div>
                
                <button id="reset-axes-btn" class="top-btn" title="Reset View">
                    RESET<br>AXES
                </button>
                
                <button id="mode-toggle-btn" class="top-btn" title="Toggle Transform/Geometry Mode">
                    <span id="mode-label">Transform</span>
                </button>
            </div>
            
            <!-- Second Button Row -->
            <div class="top-button-row">
                <button id="grid-toggle-btn" class="top-btn" title="Toggle Grid">
                    <span id="grid-label">Hide Grid</span>
                </button>
                
                <button id="invariant-toggle-btn" class="top-btn" title="Cycle Invariant Display">
                    <span id="invariant-label">Invariant:<br>Pulse</span>
                </button>
                
                <button id="dimension-toggle-btn" class="top-btn" title="Toggle 2D/3D">
                    <span id="dimension-label">3D</span>
                </button>
            </div>
            
            <!-- Theme Toggle (separate) -->
            <div style="margin-bottom: 15px;">
                <button id="theme-toggle" class="secondary-btn" title="Toggle Theme">
                    <svg id="light-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display: inline-block; vertical-align: middle; opacity: 0; transition: opacity 0.3s;">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                    <span style="margin: 0 6px;">Light</span>
                    <svg id="dark-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display: inline-block; vertical-align: middle; opacity: 1; transition: opacity 0.3s;">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <span style="margin-left: 6px;">Dark</span>
                </button>
            </div>
            
            <!-- App Mode Selector (hidden) -->
            <div class="app-mode-selector" style="display: none;">
                <button id="app-mode-transform" class="app-mode-btn active">Transform</button>
                <button id="app-mode-geometry" class="app-mode-btn">Geometry</button>
            </div>

            <!-- Objects List (matrices and vectors, shared between modes) -->
            <div id="objects-container">
                <!-- Matrices and vectors will be added here dynamically -->
            </div>

            <!-- Transform Mode Content -->
            <div id="transform-mode-content" class="mode-content">
                <!-- Animation Controls -->
                <div class="animation-controls">
                    <h3>Animation</h3>
                    <button id="animate-btn" class="primary-btn">Animate Transformation</button>
                    <button id="reset-btn" class="secondary-btn">Reset</button>
                    <div class="slider-control">
                        <label for="speed-slider">Animation Speed:</label>
                        <input type="range" id="speed-slider" min="0.5" max="5" step="0.5" value="2">
                        <span id="speed-value">2.0s</span>
                    </div>
                </div>
            </div>

            <!-- Geometry Mode Content -->
            <div id="geometry-mode-content" class="mode-content" style="display: none;">
                <!-- Object Type Selector -->
                <div class="geometry-type-selector">
                    <h3>Add Object</h3>
                    <button class="geometry-type-btn active" data-type="vector">Vector</button>
                    <button class="geometry-type-btn" data-type="line">Line</button>
                    <button class="geometry-type-btn" data-type="plane">Plane</button>
                </div>

                <!-- Vector Input -->
                <div id="geom-vector-input" class="geometry-input">
                    <h3>Vector</h3>
                    <p style="font-size: 12px; color: #aaa; margin-bottom: 10px;">Drag on canvas or enter coordinates</p>
                    <div class="coord-input">
                        <label>x: <input type="number" id="vec-x" value="0" step="0.1"></label>
                        <label>y: <input type="number" id="vec-y" value="0" step="0.1"></label>
                        <label id="vec-z-container">z: <input type="number" id="vec-z" value="0" step="0.1"></label>
                    </div>
                    <button id="add-vector-btn" class="primary-btn">Add Vector</button>
                </div>

                <!-- Line Input -->
                <div id="geom-line-input" class="geometry-input" style="display: none;">
                    <h3>Line Equation</h3>
                    <p style="font-size: 12px; color: #aaa; margin-bottom: 8px;">Parametric: r = a + tb</p>
                    <div class="coord-input">
                        <label style="margin-bottom: 8px; display: block; color: #bbb;">Point a:</label>
                        <label>x: <input type="number" id="line-ax" value="0" step="0.1"></label>
                        <label>y: <input type="number" id="line-ay" value="0" step="0.1"></label>
                        <label id="line-az-container">z: <input type="number" id="line-az" value="0" step="0.1"></label>
                    </div>
                    <div class="coord-input" style="margin-top: 10px;">
                        <label style="margin-bottom: 8px; display: block; color: #bbb;">Direction b:</label>
                        <label>x: <input type="number" id="line-bx" value="1" step="0.1"></label>
                        <label>y: <input type="number" id="line-by" value="0" step="0.1"></label>
                        <label id="line-bz-container">z: <input type="number" id="line-bz" value="0" step="0.1"></label>
                    </div>
                    <button id="add-line-btn" class="primary-btn">Add Line</button>
                </div>

                <!-- Plane Input -->
                <div id="geom-plane-input" class="geometry-input" style="display: none;">
                    <h3>Plane Equation</h3>
                    <p style="font-size: 12px; color: #aaa; margin-bottom: 8px;">ax + by + cz = d</p>
                    <div class="coord-input">
                        <label>a: <input type="number" id="plane-a" value="0" step="0.1"></label>
                        <label>b: <input type="number" id="plane-b" value="0" step="0.1"></label>
                        <label>c: <input type="number" id="plane-c" value="1" step="0.1"></label>
                        <label>d: <input type="number" id="plane-d" value="0" step="0.1"></label>
                    </div>
                    <button id="add-plane-btn" class="primary-btn">Add Plane</button>
                </div>

                <!-- Geometry Objects List -->
                <div class="vector-display">
                    <h3>Objects</h3>
                    <div id="geometry-list"></div>
                </div>
            </div>
        </div>

        <!-- 3D Canvas -->
        <div class="canvas-container">
            <canvas id="three-canvas"></canvas>
            <div class="canvas-instructions">
                <p id="control-instructions">üñ±Ô∏è Drag to create vectors | Right click: Pan | Scroll: Zoom</p>
            </div>
        </div>
    </div>

    <script type="importmap">
    {
        "imports": {
            "three": "https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.module.js",
            "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.160.0/examples/jsm/"
        }
    }
    </script>
    </div><!-- End Main App Container -->
    
    <script type="module" src="app.js"></script>
    <script>
        // Register Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/service-worker.js')
                    .then((registration) => {
                        console.log('Service Worker registered successfully:', registration.scope);
                    })
                    .catch((error) => {
                        console.log('Service Worker registration failed:', error);
                    });
            });
        }
    </script>
</body>
</html>
